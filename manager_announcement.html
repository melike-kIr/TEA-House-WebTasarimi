<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tea House - Duyurular YÃ¶netimi</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <link href="css/admin_style.css" rel="stylesheet">

    <style>
        .form-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); 
            border: 1px solid #dee2e6;
        }
        .copyright-admin {
            margin-left: 250px; 
            background-color: #aa98ca7e; 
            border-top: 1px solid #e9ecef;
            padding: 1rem 0;
            width: calc(100% - 250px);
        }
    </style>
</head>

<body>

    <div class="sidebar bg-dark text-white p-3">
        <h3 class="mb-5 text-center border-bottom pb-3">ğŸµ Tea House Admin</h3>
        <a href="manager.html"><i class="bi bi-grid-fill me-2"></i> Dashboard</a>
        <a href="manager_product.html"><i class="bi bi-box-seam me-2"></i> ÃœrÃ¼n YÃ¶netimi</a>
        <a href="manager_announcement.html" class="active"><i class="bi bi-megaphone me-2"></i> Duyurular</a>
        <a href="manager-users.html"><i class="bi bi-people me-2"></i> Aboneler</a>
        
        <div class="mt-5 pt-5 border-top">
            <a href="index.html" class="mt-4"><i class="bi bi-box-arrow-left me-2"></i> Ã‡Ä±kÄ±ÅŸ Yap</a>
        </div>
    </div>


    <div class="content p-5">
        <h1 class="display-6 fw-bold mb-4 border-bottom pb-2">Duyuru YÃ¶netimi</h1>

        <div class="form-card mb-5">
            <h3 class="mb-4 text-primary"><i class="bi bi-plus-circle-fill me-2"></i> Yeni Duyuru Ekle</h3>
            
            <form id="duyuruEkleFormu">
                
                <div class="mb-3">
                    <label for="duyuruBaslik" class="form-label fw-bold">BaÅŸlÄ±k *</label>
                    <input type="text" class="form-control" id="duyuruBaslik" required maxlength="100">
                    <div class="form-text">Maksimum 100 karakter.</div>
                </div>

                <div class="mb-3">
                    <label for="duyuruIcerik" class="form-label fw-bold">Duyuru Ä°Ã§eriÄŸi *</label>
                    <textarea class="form-control" id="duyuruIcerik" rows="4" required maxlength="1000"></textarea>
                    <div class="form-text">Maksimum 1000 karakter. (Alt satÄ±r iÃ§in &lt;br&gt; etiketi kullanabilirsiniz)</div>
                </div>

                <div class="mb-3">
                    <label for="duyuruURL" class="form-label fw-bold">URL (Detay SayfasÄ±) (Ä°steÄŸe BaÄŸlÄ±)</label>
                    <input type="url" class="form-control" id="duyuruURL" placeholder="store.html?category=new">
                    <div class="form-text">KullanÄ±cÄ±nÄ±n yÃ¶nlendirileceÄŸi sayfa adresi.</div>
                </div>
                
                <div id="mesajAlani" class="mt-4"></div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary btn-lg me-2"><i class="bi bi-send-fill me-2"></i> Duyuruyu Kaydet</button>
                    <button type="button" class="btn btn-outline-secondary btn-lg" onclick="document.getElementById('duyuruEkleFormu').reset();"><i class="bi bi-arrow-counterclockwise me-2"></i> Formu Temizle</button>
                </div>
            </form>
        </div>

        <h3 class="mt-5 mb-4 border-bottom pb-2">Mevcut Duyurular Listesi</h3>
        <div class="card shadow-sm border-0">
            <div class="card-body p-0">
                <div id="duyuruListesi">
                    <p class="text-muted p-4">Duyurular yÃ¼kleniyor...</p>
                </div>
            </div>
        </div>

    </div>

    <div class="container-fluid copyright-admin py-4">
        <div class="container-fluid">
            <div class="row px-5">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a class="fw-medium" href="#">Ã‡ay SatÄ±ÅŸ Sitesi</a>, Melike KIR. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.
                </div>
                <div class="col-md-6 text-center text-md-end">
                    GeliÅŸtirme: Melike KIR | Tema KaynaÄŸÄ±: <a class="fw-medium" href="https://themewagon.com">ThemeWagon</a>
                </div>
            </div>
        </div>
    </div>
    <script>

function getDuyurular() {
    const duyurularJSON = localStorage.getItem('duyurular');
    return duyurularJSON ? JSON.parse(duyurularJSON) : [];
}

function saveDuyurular(duyurular) {
    localStorage.setItem('duyurular', JSON.stringify(duyurular));
}


function duyuruEkle(baslik, icerik, url) {
    const duyurular = getDuyurular();
    const maxId = duyurular.length > 0 ? Math.max(...duyurular.map(d => d.id)) : 0; 
    const yeniId = maxId + 1;
    
    const yeniDuyuru = {
        id: yeniId,
        baslik: baslik,
        icerik: icerik,
        tarih: new Date().toLocaleDateString('tr-TR'),
        url: url || ''
    };

    duyurular.push(yeniDuyuru);
    saveDuyurular(duyurular);

    document.getElementById('mesajAlani').innerHTML = '<div class="alert alert-success"><i class="bi bi-check-circle-fill me-2"></i> Duyuru baÅŸarÄ±yla eklendi! ID: ' + yeniId + '</div>';
    
    document.getElementById('duyuruEkleFormu').reset(); 
    renderDuyuruListesi(); 
}


function deleteDuyuru(id) {
    const duyuruId = parseInt(id); 
    
    if (confirm(`GerÃ§ekten ID: ${duyuruId} olan duyuruyu silmek istiyor musunuz?`)) {
        let duyurular = getDuyurular();
        
        const updatedDuyurular = duyurular.filter(duyuru => duyuru.id !== duyuruId);

        saveDuyurular(updatedDuyurular);
        
        document.getElementById('mesajAlani').innerHTML = `<div class="alert alert-danger"><i class="bi bi-trash-fill me-2"></i> ID: ${duyuruId} baÅŸarÄ±yla silindi.</div>`;
        
        renderDuyuruListesi(); 

        if (typeof loadAnnouncementsCarousel === 'function') {
            loadAnnouncementsCarousel();
        }
    }
}


function renderDuyuruListesi() {
    const duyurular = getDuyurular();
    const listeAlani = document.getElementById('duyuruListesi');
    
    if (duyurular.length === 0) {
        listeAlani.innerHTML = '<div class="alert alert-info border-0"><i class="bi bi-info-circle-fill me-2"></i> HenÃ¼z eklenmiÅŸ duyuru bulunmamaktadÄ±r.</div>';
        return;
    }

    let html = `
        <div class="table-responsive">
            <table class="table table-hover table-striped mb-0">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 50px;">ID</th>
                        <th style="width: 30%;">BaÅŸlÄ±k</th>
                        <th>Ä°Ã§erik Ã–nizlemesi</th>
                        <th style="width: 100px;">Tarih</th>
                        <th style="width: 50px;">URL</th>
                        <th style="width: 100px;">Ä°ÅŸlemler</th>
                    </tr>
                </thead>
                <tbody>
    `;

    const siraliDuyurular = [...duyurular].reverse();

    siraliDuyurular.forEach(duyuru => {
        const urlLink = duyuru.url ? 
            `<a href="${duyuru.url}" target="_blank" class="btn btn-sm btn-outline-success"><i class="bi bi-link"></i></a>` : 
            `<span class="text-muted">-</span>`;
            
        // Ä°Ã§erik Ã¶nizlemesindeki HTML etiketlerini (Ã¶rneÄŸin <br>) temizle
        const temizIcerik = duyuru.icerik
            .replace(/<br\s*\/?>/gi, ' ')
            .replace(/<[^>]*>?/gm, '');

        html += `
            <tr>
                <td class="fw-bold">${duyuru.id}</td>
                <td>${duyuru.baslik}</td>
                <td>${temizIcerik.substring(0, 80)}...</td> 
                <td>${duyuru.tarih}</td>
                <td>${urlLink}</td>
                <td>
                    <button class="btn btn-sm btn-danger delete-btn" data-id="${duyuru.id}"><i class="bi bi-trash"></i> Sil</button>
                </td>
            </tr>
        `;
    });

    html += '</tbody></table></div>';
    listeAlani.innerHTML = html;
    
    attachDeleteListeners(); 
}

function attachDeleteListeners() {

    const deleteButtons = document.querySelectorAll('.delete-btn'); 
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            const idToDel = e.currentTarget.getAttribute('data-id'); 
            if (idToDel) {
                deleteDuyuru(idToDel);
            }
        });
    });
}


document.addEventListener('DOMContentLoaded', () => {
    renderDuyuruListesi(); 

    const form = document.getElementById('duyuruEkleFormu');
    
    if (form) {
        form.addEventListener('submit', (e) => {
            e.preventDefault(); 
            
            const baslik = document.getElementById('duyuruBaslik').value;
            const icerik = document.getElementById('duyuruIcerik').value;
            const url = document.getElementById('duyuruURL').value;
            
            if (baslik.trim() !== '' && icerik.trim() !== '') {
                duyuruEkle(baslik, icerik, url);
            } else {
                 document.getElementById('mesajAlani').innerHTML = '<div class="alert alert-warning"><i class="bi bi-exclamation-triangle-fill me-2"></i> BaÅŸlÄ±k ve iÃ§erik alanlarÄ± boÅŸ bÄ±rakÄ±lamaz!</div>';
            }
        });
    }
});
</script>

</body>
</html>